#!/usr/bin/env -S uiua run
# vim: set filetype=uiua :
# Experimental!
~ "git: https://github.com/donstenzel/hypertext.ua" ~ Server
~ "git: https://github.com/donstenzel/uiqlite" ~ C! PExec Q!

# U~Database!"storage.db"

~Unit {ID Name}
~Humidity {Level Timestamp Unit}

# ? humidity db
Insert ← PExec Humidity!Q!(
  INSERT INTO Humidity (Timestamp : Level : Unit)
  VALUES ($t : $l : $u).
) ⊂⌊now

R ← Server!(
  °⊓"POST" "/"⊸Req!⊃Method Path
  ⍩(°json Req~Data
    ⬚NaN get{"Humidity" "Unit"}
    C!˜Insert "storage.db"
    "204 No Content" [] ""
  )
)

Err ← "500 Internal Server Error" [] ⋅""

Server!(
  Cfg ⊚4 8080
  Run‼R Err
)
